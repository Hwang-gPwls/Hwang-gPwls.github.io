# Redux toolkit with Typescript

Redux toolkit에 대해 알아보자

Redux Toolkit은 이미 TypeScript로 작성되었으므로 TS 유형 정의가 내장되어 있다.

### 왜 사용할까?

1. 다른 라이브러리들의 추가 설치가 너무 많이 필요 했다.
2. 많은 양의 보일러플레이트 코드를 파일마다 반복 작성 해야 한다.

등 리덕스의 단점을 보안하기 위해 사용한다.

### Redux toolkit 사용하기

1. Store 만들기

기존에는 `createStore`라는 API로 store를 생성하고 middleware를 통해 redux devtools 설정을 추가해줬다. 이 API가 RSK에서는 `configureStore`로 지원하면서 default로 redux devtools를 지원하게 되었다.

```jsx
// app/store.ts

import { configureStore } from "@reduxjs/toolkit";

export const store = configureStore({
  reducer: {
    //리덕스 스토어의 rootReducer를 설정
    counter: counterReducer,
  },
});

export type RootState = ReturnType<typeof store.getState>;
export type AppDispatch = typeof store.dispatch;
```

2. Dispatch와 Selector hook으로 빼기

useSelector를 잘못 사용하게 되면 리랜더링이 많이 일어나는 안티코드를 작성할 수도 있고, 같은 코드를 여러 번 사용하게 되기 때문에 hook으로 만들어 사용한다.

```jsx
// app/hooks.ts

import { useDispatch, useSelector } from "react-redux";
import type { TypedUseSelectorHook } from "react-redux";
import type { RootState, AppDispatch } from "./store";

export const useAppDispatch: () => AppDispatch = useDispatch;
export const useAppSelector: TypedUseSelectorHook<RootState> = useSelector;
```

3. createSlice

[ducks pattern](https://github.com/erikras/ducks-modular-redux) 또한 slice라는 이름으로 공식 지원한다. createSlice 함수는 선언한 slice의 name에 따라서 액션 생성자, 액션 타입, 리듀서를 자동으로 생성해준다. 따라서 별도로 createAction이나 createReducer를 사용하지 않아도 된다. createSlice는 `name`, `initialState`, `reducers`세 가지를 넘겨주면 된다.

RSK에서 제공되는 `createSlice`의 API는 내부적으로 immer의 produce API를 포용했다. 그렇기 때문에 mutable하게 상태를 변경해도 이를 감지하여 새로운 객체를 생산하여 return하게 된다.

```jsx
// features/counter/counterSlice.ts

import { createSlice } from "@reduxjs/toolkit";
import type { PayloadAction } from "@reduxjs/toolkit";
import type { RootState } from "../../app/store";

interface CounterState {
  value: number;
}

// 초기값 설정
const initialState: CounterState = {
  value: 0,
};

export const counterSlice = createSlice({
  name: "counter",
  initialState,
  reducers: {
    increment: (state) => {
      state.value += 1;
    },
    decrement: (state) => {
      state.value -= 1;
    },
    incrementByAmount: (state, action: PayloadAction<number>) => {
      state.value += action.payload;
    },
  },
});

// Action, Reducer를 export 한다.
export const { increment, decrement, incrementByAmount } = counterSlice.actions;
export const selectCount = (state: RootState) => state.counter.value;

export default counterSlice.reducer;
```

4. Component 에서의 사용

```jsx
// Counter.tsx

import React, { useState } from "react";
import { useAppSelector, useAppDispatch } from "app/hooks";
import { decrement, increment } from "./counterSlice";

export const Counter = () => {
  const count = useAppSelector((state) => state.counter.value);
  const dispatch = useAppDispatch();
};
```

### 정리

현재 토이 프로젝트로 진행하고 있는 간단한 쇼핑몰 페이지에 리덕스 툴킷을 적용하여 개발하려고 한다. redux의 개념을 좀 더 잘 이해하며 사용해야겠다는 생각도 들고, 어렵지만 회사에서 진행하는 큰 프로젝트에는 어쩌면 필수로 사용해야 좀 더 좋은 성능과 좋은 품질의 코드로 개발할 수 있겠다는 생각도 들어 열심히 공부하고 적용하는 과정을 거쳐야겠다.

**※ Reference**

[https://redux-toolkit.js.org/](https://redux-toolkit.js.org/)

[https://jbee.io/react/introduce-redux-starter-kit/](https://jbee.io/react/introduce-redux-starter-kit/)
